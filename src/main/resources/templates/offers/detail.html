<!DOCTYPE html>
<html lang="cs"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Detail nabÃ­dky</title>
</head>

<body>

<h2>Detail nabÃ­dky</h2>

<p>
    <strong>ZÃ¡kaznÃ­k:</strong>
    <span th:text="${offer.customerName}"></span><br>

    <strong>Email:</strong>
    <span th:text="${offer.customerEmail}"></span><br>

    <strong>Popis:</strong>
    <span th:text="${offer.description}"></span><br>

    <strong>Cena:</strong>
    <span th:text="${offer.totalPrice} + ' KÄ'"></span><br>

    <strong>Stav:</strong>
    <strong th:text="${offer.status}"></strong><br>

    <strong>Revize:</strong>
    <span th:text="${offer.revision}"></span>

    <span th:if="${offer.inEdit}" style="color:red;font-weight:bold;">
        (prÃ¡vÄ› editovÃ¡no)
    </span>
</p>

<hr>

<!-- ================= WORKFLOW ================= -->

<!-- NOVA -->
<div th:if="${offer.status.name() == 'NOVA'}">
    <form th:action="@{/offers/{id}/send(id=${offer.id})}"
          method="post"
          onsubmit="return confirm('Odeslat nabÃ­dku?');">

        <input type="hidden"
               th:name="${_csrf.parameterName}"
               th:value="${_csrf.token}" />

        <button type="submit">ğŸ“¤ Odeslat nabÃ­dku</button>
    </form>
</div>

<!-- ODESLANA -->
<div th:if="${offer.status.name() == 'ODESLANA'}">
    <p style="color:#ff9800;font-weight:bold;">
        NabÃ­dka byla odeslÃ¡na a ÄekÃ¡ na reakci.
    </p>

    <form th:action="@{/offers/{id}/request-fix(id=${offer.id})}"
          method="post">

        <input type="hidden"
               th:name="${_csrf.parameterName}"
               th:value="${_csrf.token}" />

        <label>DÅ¯vod k ÃºpravÄ›:</label><br>
        <textarea name="note" required rows="4" cols="60"></textarea><br><br>

        <button type="submit">â†© VrÃ¡tit k ÃºpravÄ›</button>
    </form>
</div>

<!-- K_UPRAVE -->
<div th:if="${offer.status.name() == 'K_UPRAVE'}">
    <p style="color:#2196f3;font-weight:bold;">
        NabÃ­dka je vrÃ¡cena k ÃºpravÄ›.
    </p>

    <a th:href="@{/offers/edit/{id}(id=${offer.id})}">
        âœ Upravit nabÃ­dku
    </a>
</div>

<hr>

<!-- ================= HISTORIE ================= -->
<h3>Historie zmÄ›n stavu</h3>

<table border="1" cellpadding="5">
    <thead>
    <tr>
        <th>Kdy</th>
        <th>Kdo</th>
        <th>Z</th>
        <th>Na</th>
        <th>PoznÃ¡mka</th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="h : ${history}">
        <td th:text="${#temporals.format(h.changedAt,'dd.MM.yyyy HH:mm')}"></td>
        <span th:text="${h.changedBy?.username ?: 'ZÃ¡kaznÃ­k'}"></span>
        <td th:text="${h.fromStatus}"></td>
        <td th:text="${h.toStatus}"></td>
        <td th:text="${h.note}"></td>
    </tr>
    </tbody>
</table>

<hr>

<!-- ================= REVIZE ================= -->
<h3>Revize nabÃ­dky</h3>

<table border="1" cellpadding="5">
    <thead>
    <tr>
        <th>Revize</th>
        <th>VytvoÅ™eno</th>
        <th>Autor</th>
        <th>Popis</th>
        <th>Cena</th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="r : ${revisions}">
        <td th:text="${r.revisionNumber}"></td>
        <td th:text="${#temporals.format(r.createdAt,'dd.MM.yyyy HH:mm')}"></td>
        <td th:text="${r.createdBy.username}"></td>
        <td th:text="${r.description}"></td>
        <td th:text="${r.totalPrice} + ' KÄ'"></td>
    </tr>
    </tbody>
</table>

<br>

<a th:href="@{/}">â† ZpÄ›t na dashboard</a>

</body>
</html>
