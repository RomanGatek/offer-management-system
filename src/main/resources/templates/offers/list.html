<!DOCTYPE html>
<html lang="cs"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Nabídky</title>
</head>
<body>

<h2>Seznam nabídek</h2>

<a th:href="@{/offers/new}">+ Nová nabídka</a>
<br><br>

<table border="1">
    <thead>
    <tr>
        <th>Zákazník</th>
        <th>Popis</th>
        <th>Cena</th>
        <th>Stav</th>
        <th>Akce</th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="offer : ${offers}">
        <td th:text="${offer.customerName}"></td>
        <td th:text="${offer.description}"></td>
        <td th:text="${offer.totalPrice}"></td>
        <td th:text="${offer.status}"></td>

        <td>
            <a th:href="@{'/offers/edit/' + ${offer.id}}">Upravit</a>

            <form th:if="${offer.status.name() == 'NOVA'}"
                  sec:authorize="hasRole('USER')"
                  th:action="@{'/offers/' + ${offer.id} + '/send'}"
                  method="post"
                  style="display:inline">
                <button>Odeslat</button>
            </form>

            <form th:if="${offer.status.name() == 'ODESLANA'}"
                  sec:authorize="hasRole('ADMIN')"
                  th:action="@{'/offers/' + ${offer.id} + '/accept'}"
                  method="post"
                  style="display:inline">
                <button>Přijmout</button>
            </form>

            <form th:if="${offer.status.name() == 'ODESLANA'}"
                  sec:authorize="hasRole('ADMIN')"
                  th:action="@{'/offers/' + ${offer.id} + '/reject'}"
                  method="post"
                  style="display:inline">
                <button>Zamítnout</button>
            </form>

            <a th:href="@{'/offers/' + ${offer.id}}">Detail</a> |
            <a th:href="@{'/offers/export/' + ${offer.id}}">PDF</a>
        </td>

        <!-- ADMIN → SMAZAT -->
            <span sec:authorize="hasRole('ADMIN')">
                <a th:href="@{'/offers/delete/' + ${offer.id}}"
                   onclick="return confirm('Opravdu smazat?');">
                    Smazat
                </a>
            </span>

            |
            <a th:href="@{'/offers/export/' + ${offer.id}}">PDF</a>
        </td>
    </tr>
    </tbody>
</table>

</body>
</html>